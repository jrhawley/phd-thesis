\section{Methods}

\subsection{Patient selection criteria}

Patients were selected from the CPC-GENE cohort of Canadian men with indolent PCa, Gleason scores of 3+3, 3+4, and 4+3.
All primary human material was obtained with informed consent with approval of our institutional research ethics board (UHN 11-0024).
The intersection of previously published data for whole genome sequencing \cite{fraserGenomicHallmarksLocalized2017}, RNA abundance \cite{chenWidespreadFunctionalRNA2019}, and H3K27ac ChIP-seq \cite{kronTMPRSS2ERGFusion2017} led to 25 samples having data for all assays.
11 of these tested positive for ETS gene family fusions (T2E status), and 14 without.
To accurately represent the presence of this subtype of PCa in the disease generally, and to ensure minimum read depths required to perform accurate analysis on chromatin conformation data, we selected approximately half of these remaining samples (6 T2E+ and 6 T2E-).

\subsection{Patient Tumour in situ low-input Hi-C Sequencing}

We followed the general in situ low input Hi-C (Low-C) protocol from Diaz \emph{et al.}, 2018 \cite{diazChromatinConformationAnalysis2018} with our own re-optimization for solid tumour tissue sections.
It is worth noting that throughout the protocol, the pellet would be hardly visible and would require careful pipetting.
The specific modifications of the protocol are described below.

\subsubsection{Tumour Tissue Preparation}

Twelve cryopreserved-frozen PCa tumour tissue specimens were obtained from primary PCa patients as part of the Canadian PCa Genome Network (CPC-GENE) effort \cite{fraserGenomicHallmarksLocalized2017}.
Informed consent was obtained from all patients with REB approval (UHN 11-0024).
These tumour specimens were sectioned into 10 $\mu$m sections.
Sections before and after the sections used for Hi-C were stained with hematoxylin and eosin (H\&E) and assessed pathologically for $\ge$ 70\% PCa cellularity.
The percentage of infiltrating lymphocytes was also estimated by pathological assessment to be $\le$ 3\%.
Stratification into T2E+ or T2E- was determined through either whole-genome sequencing detection of the rearrangement, immunohistochemistry, or mRNA expression microarray data \cite{fraserGenomicHallmarksLocalized2017}.

\subsubsection{Normal Tissue Preparation}

Five snap-frozen prostate tumour-adjacent normal tissue specimens were obtained.
Informed consent was obtained from all patients with REB approval (UHN 11-0024).
Tissue specimens were sectioned into 5, 10, and 20 $\mu$m sections.
Sections used for Hi-C and RNA-seq were stained with H\&E and assessed pathologically for $\ge$ 60\% prostate glandular cellularity.

\subsubsection{Fixation and Lysis}

One or two sections (consecutive; depending on surface area) for each patient were thawed and fixed by adding 300 $\mu$L of 1\% formaldehyde in PBS directly onto the tissue sample, followed by a 10-minute incubation at room temperature (RT) (Supplementary Figure 1a).
The formaldehyde was quenched by adding 20 $\mu$L of 2.5M glycine to the sample reaching a final concentration of 0.2M followed by 5 minutes of incubation at RT.
The samples were then washed three times with 500 $\mu$L cold PBS and scraped off the microscope slide with a scalpel into 1.5 mL centrifuge tube containing 250 $\mu$L of ice-cold Low-C lysis buffer (10 mM Tris-Cl pH 8.0, 10 mM NaCl, 0.2\% IGEPAL CA-630 (Sigma-Aldrich)) supplemented with protease inhibitor.
The samples were then mixed thoroughly by gentle pipetting and left on ice for 20 minutes with intermittent mixing.
Upon lysis, the samples were snap-frozen with liquid nitrogen and stored at -80 \textdegree C until processing the next day.
As a note, stagger fixation times when processing multiple samples to prevent needless rush and chance of under/over-fixation.

\subsubsection{Enzyme Digestion and Overhang Fill-In}

The samples stored at -80 \textdegree C were thawed on ice and spun down at 300 $\times$ g for 5 minutes at 4 \textdegree C.
The samples were then re-suspended in 125 $\mu$L of ice-cold 10X NEB2 Buffer (New England Biolabs), and again spun down at 13,000 $\times$ g for 5 minutes at 4 \textdegree C.
The pellet was then re-suspended in 25 $\mu$L of 0.4\% SDS and incubated at 65 \textdegree C for 10 minutes without agitation for permeabilization.
To quench the SDS, 10\% Triton X-100 in water (12.5 $\mu$L + 75 $\mu$L water) was then added to the samples and incubated at 37 \textdegree C for 45 minutes at 650 rpm.
For enzymatic digestion, 35 $\mu$L of 10X NEB2.1 buffer (New England Biolabs) was added to each sample, follow by the addition of 50 U of MboI and 90 minutes incubation at 37 \textdegree C with gentle agitation (add 30 U first, incubate 45 minutes, followed by the addition of another 20 U and another 45 minutes of incubation).
Upon digestion, the MboI enzyme was inactivated by incubating at 62 \textdegree C for 20 minutes.
The overhangs generated by the MboI enzyme was then filled-in by adding a mix of dNTPs and DNA Polymerase I Klenow Fragment directly to each sample (10 $\mu$L of 0.4 mM biotin-14-dCTP, 0.5 $\mu$L of 10 mM dATP, 0.5 $\mu$L of 10 mM dGTP, 0.5 $\mu$L of 10 mM dTTP, 4 $\mu$L of 5U/$\mu$L DNA Polymerase I Klenow Fragment).
The samples were then mixed by gentle pipetting followed by incubation at 37 \textdegree C for 90 minutes with gentle agitation.

\subsubsection{Proximity Ligation and De-crosslinking}

Upon overhang fill-in, each sample was subject to proximity ligation through the addition of 328.5 $\mu$L water, 60 $\mu$L of 10X T4 DNA Ligase Buffer (ThermoFisher Scientific), 50 $\mu$L of 10\% Triton X-100, 6 $\mu$L of 20 mg/mL BSA (New England Biolabs) and 3.5 $\mu$L of 5 Weiss U/$\mu$L T4 DNA Ligase (ThermoFisher).
The samples were mixed through gentle pipetting and incubated at RT (20-22 \textdegree C) with rotation for 4 hours.
The samples were then spun down at 13,000 $\times$ g for 5 minutes at RT and re-suspended in 250 $\mu$L of Extraction Buffer (50 mM Tris-Cl pH 8.0, 50 mM NaCl, 1 mM EDTA, 1\% SDS) upon removal of supernatant.
Next, 10 $\mu$L of 20 mg/mL Proteinase K (New England Biolabs) was added to each sample and incubated at 55 \textdegree C for 30 minutes at 1,000 rpm.
Then 65 $\mu$L of 5 M NaCl was added to each sample and incubated at 65 \textdegree C at 1,000 rpm overnight.

\subsubsection{DNA Extraction}

Phenol-chloroform extraction columns were spun down at 17,000 $\times$ g for 1 minute at 4 \textdegree C to get gel down to the bottom of the tube.
The samples incubated overnight were then added to the column.
Next, an equal volume (\textapprox 325 $\mu$L) of phenol-chloroform-isoamyl alcohol mixture (25:24:1) (Sigma) was also added to the column.
The column was then inverted for thorough mixing and spun down at 17,000 $\times$ g for 5 minutes at 4 \textdegree C.
The surface layer on top of the gel upon spinning contains the sample and is transferred to a clean 1.5 mL tube (\textapprox 325 $\mu$L).
Each sample was mixed with 31.5 $\mu$L of 3M sodium acetate, 2 $\mu$L of GlycoBlue (ThermoFisher Scientific), and 504 $\mu$L of 100\% ethanol for DNA precipitation.
The samples were inverted several times for mixing and incubated at -80 \textdegree C for 20 minutes, followed by a centrifuge spin at 17,000 $\times$ g for 45 minutes at 4 \textdegree C.
The supernatant was carefully discarded and the pellet was washed with 800 $\mu$L of ice-cold 70\% ethanol followed by a centrifuge spin at 17,000 $\times$ g for 5 minutes at 4 \textdegree C.
The supernatant was then discarded and the tube was air-dried until no traces of ethanol was left prior to dissolving the DNA pellet with 30 $\mu$L of Elution Buffer (Qiagen PCR Clean-Up Kit).
1 $\mu$L of RNase A (ThermoFisher Scientific) was added to each sample followed by incubation at 37 \textdegree C for 15 minutes.
A mix of 5 $\mu$L of 10X NEB2.1 buffer (New England Biolabs), 1.25 $\mu$L of 1 mM dATP, 1.25 $\mu$L of 1 mM dCTP, 1.25 $\mu$L of 1 mM dGTP, 1 mM of dTTP, 0.5 $\mu$L of 10 mg/mL BSA, 5 $\mu$L of water, 3.5 $\mu$L of 3 U/$\mu$L T4 DNA Polymerase (New England Biolabs) was added to each sample.
The samples were mixed thoroughly by gentle pipetting, and then incubated at 20 \textdegree C for 4 hours.

\subsubsection{Fragmentation and Biotin Pull-down}

70 $\mu$L of water was added to each sample bringing total volume up to 120 $\mu$L, and the samples were transferred into Covaris sonication tubes.
The samples were then sonicated using Covaris M220 sonicator to attain 300-700 bp fragments.
For biotin pull-down using a magnetic rack, 30 $\mu$L of Dynabeads MyOne Streptavidin C1 beads (Life Technologies) for each sample was washed once with 400 $\mu$L of 1X B\&W buffer + 0.1\% Triton X-100.
The beads were then re-suspended in 120 $\mu$L of 2X B\&W buffer and transferred to the 120 $\mu$L of sample (1:1 ratio).
The sample was then incubated with gentle rotation at RT for 20 minutes.
The supernatant was discarded and the beads were re-suspended with 400 $\mu$L of 1X B\&W buffer + 0.1\% Triton X-100 followed by a 2-minute incubation at 55 \textdegree C with mixing.
The wash was repeated once more, then re-suspended in 400 $\mu$L of 1X NEB2 buffer (New England Biolabs).

\subsubsection{Library Preparation and Size Selection}

The beads containing the Hi-C samples were separated on a magnetic rack to remove the supernatant.
The beads were then re-suspended in a total volume of 10 $\mu$L for library preparation using the SMARTer ThruPLEX DNA-seq library preparation kit (Takara Biosciences) per manufacturer's protocol with an adjustment on the last step, a PCR reaction for library amplification.
Upon reaching that step, the reaction was carried out on a regular PCR for two cycles to amplify the Hi-C samples off the streptavidin beads.
Next, the samples were transferred onto a new tube where 20X SYBR was added.
The samples were then subject to real-time qPCR and pulled out from the qPCR machine mid-exponential phase.
Ultimately, this is done to reduce PCR duplication rates, a huge limitation for low-input Hi-C protocols.
The Hi-C libraries were then double size-selected for 300-700 bp using Ampure XP beads and sent for BioAnalyzer analysis prior to sequencing.

\subsection{Hi-C Sequencing and Data Pre-processing}

\subsubsection{Sequencing}

The Hi-C libraries for each tumour sample were sent for shallow paired-end 150 bp sequencing (\textapprox 10-15 million reads per sample) on a NextSeq 500.
Upon confirming library quality and low duplication rates ($<$ 2\%), samples were sent for deep paired-end 150 bp sequencing with the aim of 800 million raw read pairs per sample on NovaSeq 6000.

\subsubsection{Sequence alignment and Hi-C artefact removal}

Paired-end FASTQ files were pre-processed with HiCUP (v0.7.2) \cite{wingettHiCUPPipelineMapping2015}.
Reads were truncated at MboI ligation junction sites prior to alignment with $\texttt{hicup\_digester}$.
Each mate was independently aligned to the hg38 genome and were then paired and assigned to MboI restriction sites by $\texttt{hicup\_map}$.
$\texttt{hicup\_map}$ uses Bowtie2 (v2.3.4) \cite{langmeadFastGappedreadAlignment2012} as the underlying aligner which has the following parameters: $\texttt{--very-sensitive --no-unal --reorder}$.
Reads that reflect technical artefacts were filtered out with $\texttt{hicup\_filter}$.
Duplicate reads were removed with $\texttt{hicup\_deduplicator}$.

Reads that came from different sequencing batches were then aggregated for each tumour sample at this stage using $\texttt{sambamba merge}$ (v0.6.9) \cite{tarasovSambambaFastProcessing2015}.
This resulted in an average of $1.12 \times 10^9$ read per tumour sample (Supplementary Table 2).

\subsubsection{Contact matrix generation and balancing}

Aggregated binary alignment map (BAM) files were converted to the pairs format using pairtools (v0.2.2) \cite{goloborodkoMirnylabPairtoolsV02019} and then the cooler format using the cooler package (v0.8.5) \cite{abdennurMirnylabCoolerV02019}.
The pairs files were generated with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
pairtools parse -c {genome} --assembly hg38 -o {output_pairs} {input_bam}
\end{lstlisting}

The cooler files were generated at an initial matrix resolution of 1000 bp with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
cooler cload pairs --assembly hg38 -c1 2 -p1 3 -c2 4 -p2 5 {genome}:1000  {input_pairs} {output_cooler}
\end{lstlisting}

The raw contact matrices stored in the cooler file format were balanced using cooler's implementation of the ICE algorithm \cite{imakaevIterativeCorrectionHiC2012} using the $\texttt{cooler balance}$ command.
Contact matrices at different resolutions were created with the $\texttt{cooler zoomify}$ command.

\subsection{Hi-C Data Analysis}

\subsubsection{TAD identification}

Contact matrices were binned at a resolution of 40 kbp.
To remove sequencing depth as a confounding factor, contact matrices for all samples were first downsampled to match the sequencing depth of the shallowest sample.
For comparisons including cell lines, this was $120 \times 10^6$ contacts.
For comparisons only involving primary samples, this was $300 \times 10^6$ contacts.
This was achieved with Cooltools (v0.3.2) \cite{venevMirnylabCooltoolsV02020} with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
cooltools random-sample -c 120000000 {input}::/resolutions/40000 {output}
\end{lstlisting}

TADs were identified using TopDom \cite{shinTopDomEfficientDeterministic2016} on the downsampled, ICE-normalized contact matrices.
To identify domains at multiple length scales, similar in concept to Artamus' gamma parameter \cite{filippovaIdentificationAlternativeTopological2014}, TopDom was run multiple times per sample, with the window size parameter set at values between 3 and 40, inclusive (corresponding to 120 kbp and 1.6 Mbp).
The lower bound for the window size parameter allowed for the identification of domains multiple megabases in size at the upper end and domains $<$ 100 kbp at the lower end without being dominated by false calls due to sparsity of the data.
Despite TopDom being more resistant to confounding by sequencing depth than other \gls{tad} calling tools \cite{forcatoComparisonComputationalMethods2017}, biases in boundary persistence were evident between samples of different sequencing depth.
Downsampling contact matrices to similar depths resolved these biases.

Given the stochasticity of Hi-C sequencing, boundaries called at one window size may not correspond to the exact same location at a different window size.
To attempt to resolve these different boundary calls and leverage power from multiple window sizes, boundaries for a given patient were considered at all window sizes.
Boundaries within one bin (40 kbp) of each other and called at different window sizes were marked as conflicting calls.
If only two boundaries were in conflict and all the window sizes where the first boundary was called are smaller than the window sizes where the second boundary was called, the second boundary was selected since larger smoothing windows are less sensitive to small differences in contact counts.
If only two boundaries were in conflict but there is no proper ordering of the window sizes, the boundary that was identified most often between the two was selected.
If three boundaries are in conflict, the middle boundary was selected.
If four or more boundaries were in conflict, the boundary that was identified most often was selected.

To determine the maximum window size for \gls{tad} calls, \gls{tad} calls were compared across window sizes for the same patient using the BPscore metric \cite{zaborowskiBPscoreEffectiveMetric2019}.
TAD calls are identical when the BPscore is 0, and divergent when 1.
The cut-off window size for a single patient was determined when the difference between \gls{tad} calls at consecutive window sizes was $<$ 0.005, twice in a row.
The maximum window size was determined by the maximum window size cut-off across all samples in a comparison.
For comparisons involving only primary samples, the maximum window size was determined to be $w = 20 \times 40 \text{ kbp}$.
For comparisons involving cell lines, this was $w = 32 \times 40 \text{ kbp}$.

The persistence of a \gls{tad} boundary was calculated as the number of window sizes where this region was identified as a boundary.

\subsubsection{Sample clustering by \glsentryshortpl{tad}}

Using the \gls{tad} calls at the window size $w = 32 \times 40 \text{ kbp}$, the similarity between samples was calculated with BPscore.
The resulting matrix, containing the similarity between any two samples, was used as the distance matrix for unsupervised hierarchical clustering with $\texttt{ward.D2}$ linkage.

\subsubsection{Compartment identification}

Contact matrices were binned at a resolution of 40 kbp, similarly to \gls{tad} identification.
To remove sequencing depth as a confounding factor, contact matrices for all samples were first downsampled to match the sequencing depth of the shallowest sample.
Contact matrix eigenvectors were calculated with Cooltools.
To standardize the sign of each eigenvector, the GC content of the reference genome, binned at 40 kbp, was used as a phasing reference track.
This reference track was calculated with the $\texttt{frac\_gc}$ function from the Bioframe Python package (v0.0.12) \cite{nezarabdennurMirnylabBioframeV02020}.
The first eigenvector was used to identify compartments with the following command: 

\begin{lstlisting}[basicstyle=\ttfamily]
cooltools call-compartments --bigwig --reference-track gc-content-phase.bedGraph -o {output} {input}
\end{lstlisting}

\subsubsection{Identification of significant chromatin interactions}

Chromatin interactions were identified in all 17 primary samples with Mustache (v1.0.2) \cite{roayaeiardakanyMustacheMultiscaleDetection2020}.
Using the Cooler files from above, Mustache was run on the ICE-normalized 10 kbp contact matrix for each chromosome with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
mustache -f {input} -r 10000 -ch {chromosome} -p 8 -o {output}
\end{lstlisting}

Interaction calls on each chromosome were merged for each sample to create a single table of interaction calls across the entire genome.

To account for variances in detection across samples and to identify similarly called interactions across samples, interaction anchors were aggregated across all samples to form a consensus set.
Interaction anchors were merged if they overlapped by at least 1 bp.
Interaction anchors for each sample were then mapped to the consensus set of anchors, and these new anchors were used in all subsequent analyses.

\subsubsection{Chromatin interaction saturation analysis}

To estimate the detection of all chromatin interactions across all samples, a nonlinear regression on an asymptotic model was performed.
This is similar in method to peak saturation analysis used to assess peaks detected in ChIP-seq experiments from a collection of samples \cite{kronTMPRSS2ERGFusion2017}.
Bootstrapping the number of unique interactions detected in a random selection of n samples was calculated for n ranging from 1 to 17.
100 iterations of the bootstrapping process were performed.
An exponential model was fit against the mean number of unique interactions detected in n samples using the $\texttt{nls}$ and $\texttt{SSaymp}$ functions from the stats R package (v3.6.3).
The model was fit to the following equation:

\begin{equation*}
  \mu = \alpha + \left( R_0 - \alpha \right) \exp \left(kn \right)
\end{equation*}

where $\mu$ is the mean number of chromatin interactions for a given number of samples, $n$, $\alpha$ is the asymptotic limit of the total number of mean detected interactions, $R_0$ is the response for $n = 0$, and $k$ is the rate constant.
The estimated fit was used to predict the number of samples required to reach 50\%, 90\%, 95\%, and 99\% saturation of the asymptote (Supplementary Figure 3c).

\subsubsection{Structural variant breakpoint pair detection}

Breakpoint pairs for each patient were called on the merged BAM files using $\texttt{hic\_breakfinder}$ (commit 30a0dcc6d01859797d7c263df7335fd2f52df7b8) \cite{dixonIntegrativeDetectionAnalysis2018}.
Pre-calculated expected observation files for the hg38 genome were downloaded from the git repository on July 24, 2019, as per the instructions.
Breakpoints were explicitly called with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
hic_breakfinder --bam-file {BAM} --exp-file-inter inter_expect_1Mb.hg38.txt --exp-file-intra intra_expect_100kb.hg38.txt --name {Sample_ID} --min-1kb.
\end{lstlisting}

For the T2E fusion, only one patient had the deletion identified by $\texttt{hic\_breakfinder}$ with default parameters (CPCG0336).
Difficulties identifying \glspl{sv} with $\texttt{hic\_breakfinder}$ have been previously noted \cite{hoStructuralVariationSequencing2019}.
After adjusting the detection threshold, we were able to identify the fusion in other samples.
To ensure the T2E+ tumours were effectively stratified for future analyses, the fusion was annotated using the same coordinates for the other T2E+ samples.
No other additions to breakpoint calls were made.
Certain breakpoints that appeared to be artefacts were removed, as described below.

\subsubsection{Structural variant annotation and graph construction}

The contact matrix spanning 5 Mbp upstream and downstream around the breakpoint pairs were plotted and annotated according to previously published heuristics (Supplementary Figure 4 for \cite{dixonIntegrativeDetectionAnalysis2018}).
Breakpoint pairs that were nearby other breakpoints or did not match the heuristics in this figure were labelled as $\texttt{UNKNOWN}$.
These annotations were matched against the annotations identified from the previously published whole genome sequencing structural variants \cite{fraserGenomicHallmarksLocalized2017}.
Breakpoint pairs matching the following criteria were considered as detection artefacts and were ignored.

\begin{enumerate}
  \item At least one breakpoint was $>$ 1 Mbp
  \item At least one breakpoint was surrounded by empty regions of the contact matrix
  \item At least one breakpoint corresponded to a \gls{tad} or compartment boundary shared across all samples that lacked a distinct sharp edge that is indicative of a chromosomal rearrangement
\end{enumerate}

To identify unique breakpoints that were identified in multiple breakpoint pairs, breakpoints that were within 50 kbp of each other were considered as possibly redundant calls.
This distance was considered as the resolution of the non-artefactual calls is 100 kbp.
Plotting the contact matrix 5 Mbp around the breakpoint, breakpoints calls were considered the same breakpoint if the sharp edge of each breakpoint was equal to within 5 kbp.
Similar in concept to the ChainFinder algorithm \cite{bacaPunctuatedEvolutionProstate2013}, we consider each breakpoint as a node in a graph.
Nodes are connected if they are detected as a pair of breakpoints by $\texttt{hic\_breakfinder}$.
Simple structural variants are connected components in the breakpoint graph containing only two nodes, and complex variants those with greater than two nodes.
A visual representation of these graphs can be found in \Cref{fig:3D_figs4}b.
Graphs are displayed with a spring-force layout, adjusted using the Kamada Kawai optimization \cite{kamadaAlgorithmDrawingGeneral1989} from the NetworkX Python package (v2.4) \cite{hagbergExploringNetworkStructure2008}.

\subsubsection{Determination of structural variant breakpoints altering intra-\glsentryshortpl{tad} contacts}

Patients are assigned into one of two groups using hierarchical clustering (complete linkage) with the matrix of pairwise BPscore \cite{zaborowskiBPscoreEffectiveMetric2019} values as a distance matrix.
If the clustering equals the mutated samples from the non-mutated samples (i.e. the clustering matches the mutation status in this locus), then the local topology was classified as $\texttt{altered}$ because of the \gls{sv}.

\subsubsection{Virtual 4C}

Two parts of the BRAF gene were used as anchors for virtual 4C data: the promoter region (1500 bp upstream, 500 bp downstream of the TSS) and the entire gene downstream of the breakpoint.
Contact frequencies from the ICE-normalized, 20 kbp contact matrices were extracted, with the rows as the bins containing the anchor and the columns as the target regions (the x-axes in \Cref{fig:3D_fig6}e).
The row means were calculated to produce a single vector where each element is the average normalized contact frequency between the anchor of interest and the distal 20 kbp bin.
These vectors were plotted as lines in \Cref{fig:3D_fig6}e.

\subsection{Patient Tumour Tissue H3K27ac ChIP-seq}

ChIP-seq against H3K27ac was previously published for these matching samples in \cite{kronTMPRSS2ERGFusion2017}.
Sequencing data was processed similarly to the previous publication of this data \cite{kronTMPRSS2ERGFusion2017}; however, the hg38 reference genome was used instead of hg19.

\subsubsection{Sequence alignment}

FASTQ files from single-end sequencing were aligned to the hg38 genome using Bowtie2 (v2.3.4) with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
bowtie2 -x {genome} -U {input} 2> {output_report} | samtools view -u > {output_bam}
\end{lstlisting}

For FASTQ files from paired-end sequencing, only the first mate was considered and reads were aligned with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
bowtie2 -x {genome} -U {input} -3 50 2> {output_report} | samtools view -u > {output_bam}
\end{lstlisting}

This ensured that all H3K27ac ChIP-seq data had the same format (single-end) and length (52 bp) before alignment to mitigate possible differences in downstream analyses due to different sequencing methods.
Duplicate reads were removed with sambamba (v0.6.9) via $\texttt{sambamba markdup -r}$ and were then sorted by position using $\texttt{sambamba sort}$.

\subsubsection{Peak calling}

Peak calling was performed using MACS2 (v2.1.2) \cite{zhangModelbasedAnalysisChIPSeq2008} with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
macs2 callpeak -g hs -f BAM -q 0.005 -B -n {output_prefix} -t {seq_chip} -c {seq_input}\end{lstlisting}

ENCODE hg38 blacklist regions were then removed from the narrow peaks \cite{amemiyaENCODEBlacklistIdentification2019}.
Peaks calls are in Supplementary Table 8.

\subsubsection{Differential acetylation analysis}

Unique peak calls and de-duplicated pull-down and control BAM files from tumour samples were loaded into R with the DiffBind package (v2.14.0) \cite{starkDiffBindDifferentialBinding} using DESeq2 (v1.26.0) 84 as the differential analysis model.
3 of the 12 samples had low quality peak calls compared to the other 9 and were not considered when calculating differential acetylation (CPCG0268, CPCG0255, and CPCG0336).
We considered each unique breakpoint one at a time in the remaining 9 samples.
Samples were grouped by their mutation status (i.e. a design matrix where the mutation status is the only covariate) and DiffBind's differential binding analysis method was performed to identify all differentially acetylated regions between the two groups.
Acetylation peaks outside of the \glspl{tad} overlapping the breakpoint were filtered out.
Multiple test correction with the Benjamini-Hochberg FDR method \cite{benjaminiControllingFalseDiscovery1995} was performed on all peaks after all breakpoints were considered, due to similar group stratifications depending on the breakpoint under consideration.

\subsubsection{Structural variant breakpoint enrichment}

Structural variant breakpoint coordinates from WGS data from the CPC-GENE cohort were obtained from the International Cancer Genome Consortium (structural somatic mutations from the PRAD-CA dataset, release 28).
Breakpoint coordinates were lifted over to hg38 coordinates using the liftOver function from the rtracklayer R package (v1.46.0) \cite{lawrenceRtracklayerPackageInterfacing2009}.
Permutation tests were performed with the regioneR R package (v1.18.0) \cite{gelRegioneRBioconductorPackage2015}, selecting randomized regions from the hg38 genome, excluding the ENCODE blacklist regions \cite{amemiyaENCODEBlacklistIdentification2019} and masked loci.
100 permutations were calculated and a one-sided permutation $z$-test was used to calculate statistical significance.

\subsection{Primary Tissue RNA Data Analysis}

\subsubsection{Tumour sample RNA sequencing}

Total RNA was extracted for the CPC-GENE tumour samples as previously described \cite{chenWidespreadFunctionalRNA2019}.
Briefly, total RNA was extracted with mirVana miRNA Isolation Kit (Life Technologies) according to the manufacturer's instructions.
RNA samples were sent to BGI Americas where it underwent QC and DNase treatment.
For each sample, 200 ng of total RNA was used to construct a TruSeq strand-specific library with the Ribo Zero protocol (Illumina, Cat. \#RS-122-2203).
The libraries were sequenced on a HiSeq 2000 to a minimal target of 180 million, 2 $\times$ 100 bp paired-end reads.

\subsubsection{RNA sequencing data pre-processing}

RNA sequencing FASTQ files were pseudo-aligned to the hg38 genome using Kallisto (v0.46.1) \cite{brayNearoptimalProbabilisticRNAseq2016} with the following command:

\begin{lstlisting}[basicstyle=\ttfamily]
kallisto quant --bootstrap-samples 100 --pseudobam --threads 8 --index /path/to/GRCh38.idx --output-dir {output_dir} {input_R1.fastq.gz} {input_R2.fastq.gz}
\end{lstlisting}

\subsubsection{Differential gene expression analysis}

To assess whether \glspl{sv} were associated with local gene expression changes, we considered each unique breakpoint one at a time.
For each breakpoint, we compared the gene expression between the mutated and non-mutated tumour samples using Sleuth (v0.30.0) \cite{pimentelDifferentialAnalysisRNAseq2017,yiGenelevelDifferentialAnalysis2018} with a linear model where the mutation status was the only covariate.
To reduce the chance of falsely identifying genes as differentially expressed, only genes located within the \glspl{tad} (window size  $w = 20$) containing breakpoints were considered.
Fold-change estimates of each transcript were assessed for significance using a Wald test.
Transcript-level p-values are combined to create gene-level p-values using the Lancaster aggregation method provided by the Sleuth package \cite{yiGenelevelDifferentialAnalysis2018}.
Correcting for multiple tests was then performed with the Benjamini-Hochberg FDR correction for all genes that were potentially altered in the mutated sample(s).
